var fn=Object.defineProperty,mn=Object.defineProperties;var vn=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var qe=Math.pow,Ke=(e,t,n)=>t in e?fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,P=(e,t)=>{for(var n in t||(t={}))Be.call(t,n)&&Ke(e,n,t[n]);if(pe)for(var n of pe(t))Qe.call(t,n)&&Ke(e,n,t[n]);return e},_e=(e,t)=>mn(e,vn(t));var se=(e,t)=>{var n={};for(var a in e)Be.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&pe)for(var a of pe(e))t.indexOf(a)<0&&Qe.call(e,a)&&(n[a]=e[a]);return n};var Te=(e,t,n)=>new Promise((a,s)=>{var h=u=>{try{r(n.next(u))}catch(p){s(p)}},g=u=>{try{r(n.throw(u))}catch(p){s(p)}},r=u=>u.done?a(u.value):Promise.resolve(u.value).then(h,g);r((n=n.apply(e,t)).next())});import{e as Fe,d as oe,c as A,r as w,W as pn,N as Re,k as F,l as V,m as M,q as ee,X as ne,D as re,ac as le,a8 as ge,a7 as Ve,Z as Ge,Y as $e,ak as _n,am as gn,ao as hn,ap as yn,al as bn,aq as wn,_ as En,an as Tn,ar as Cn,F as On,p as Sn,i as xe,w as Ce,o as kn,u as In,f as Le,h as Rn,B as Oe,as as $n,H as Pn,at as Fn,ae as Ln,au as Dn}from"./antdv.cb94fff7.js";import{b as Je,c as Xe,_ as Ze}from"./index.73cc9440.js";const An=Fe({props:["hiddenFilter","button","items","model"],emits:["onSearch"],setup(e,{emit:t}){const{hasPermission:n}=Je(),{hasRole:a}=Xe(),s=oe(e.model||{}),h=A(()=>(e.items||[]).map(p=>P({type:"input"},p))),g=()=>{t("onSearch")},r=w(e.hiddenFilter);pn(()=>{!e.button&&!e.items&&(r.value=!0)});const u=A(()=>{const p=Re(e.button)||{};return _e(P({},p),{permission:n(p.auth)&&a(p.role)})});return{formModel:s,getItems:h,hasHidden:r,getButton:u,handleSubmit:g}}}),Mn={key:0,class:"text"},Nn=Ve("\u67E5\u8BE2");function jn(e,t,n,a,s,h){const g=_n,r=gn,u=hn,p=yn,_=bn,l=wn,$=En,O=Tn,S=Cn,E=On;return e.hasHidden?le("",!0):(F(),V(E,{key:0,"body-style":{padding:"0 0 24px 0"},bordered:!1},{default:M(()=>[ee(S,{class:"form-container",layout:"horizontal",model:e.formModel},{default:M(()=>[ee(O,{type:"flex"},{default:M(()=>[e.button?(F(),V(r,{key:0,flex:"100px"},{default:M(()=>{var v;return[e.button.type==="text"?(F(),ne("span",Mn,re(e.button.label),1)):le("",!0),e.getButton.permission?(F(),V(g,ge({key:1},e.button,{onClick:(v=e.button)==null?void 0:v.onClick}),{default:M(()=>[Ve(re(e.button.label),1)]),_:1},16,["onClick"])):le("",!0)]}),_:1})):le("",!0),ee(r,{flex:"auto",class:"rowE"},{default:M(()=>[ee($,null,{default:M(()=>[(F(!0),ne($e,null,Ge(e.getItems,v=>(F(),V(l,{key:v.name,name:v.name},{default:M(()=>[v.type==="select"?(F(),V(u,ge({key:0,key:`select-${v.name}`},v,{value:e.formModel[v.name],"onUpdate:value":y=>e.formModel[v.name]=y,class:"default-select-w"}),null,16,["value","onUpdate:value"])):v.type==="date"?(F(),V(p,ge({key:1,key:`date-${v.name}`},v,{value:e.formModel[v.name],"onUpdate:value":y=>e.formModel[v.name]=y,class:"default-select-w"}),null,16,["value","onUpdate:value"])):(F(),V(_,ge({key:2},v,{key:`input-${v.name}`,value:e.formModel[v.name],"onUpdate:value":y=>e.formModel[v.name]=y,onSearch:e.handleSubmit,class:"default-search-w"}),{enterButton:M(()=>[ee(g,{type:"primary"},{default:M(()=>[Nn]),_:1})]),_:2},1040,["value","onUpdate:value","onSearch"]))]),_:2},1032,["name"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}))}var Kn=Ze(An,[["render",jn],["__scopeId","data-v-49edeabf"]]);const Bn={},De=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),en=()=>Bn;Fe({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:t}){const{config:n}=e;return Sn(De,n),()=>{var a;return(a=t.default)===null||a===void 0?void 0:a.call(t)}}});const Qn=Object.prototype.toString,nn=e=>Qn.call(e),qn=e=>nn(e)==="[object String]",tn=e=>nn(e)==="[object Object]",Un=e=>Array.isArray(e),ce=e=>e!==null&&typeof e=="object",Wn=e=>ce(e)&&Ee(e.then)&&Ee(e.catch),Ee=e=>e instanceof Function,be=e=>e==null,Ae=typeof window=="undefined",Pe=()=>{var e,t;return!Ae&&((e=window)===null||e===void 0||(t=e.document)===null||t===void 0?void 0:t.visibilityState)==="visible"},Ue=()=>{var e,t,n;return(e=!Ae&&((t=window)===null||t===void 0||(n=t.navigator)===null||n===void 0?void 0:n.onLine))!==null&&e!==void 0?e:!0},Yn=e=>{const t={};return Object.keys(e).forEach(n=>{t[n]=In(e[n])}),t},ue=Promise.resolve(null),We=(...e)=>Te(void 0,null,function*(){const t=yield fetch(...e);if(t.ok)return t.json();throw new Error(t.statusText)}),Ye=(e,t,n=void 0)=>{const a=t.replace(/\[(\d+)\]/g,".$1").split(".");let s=e;for(const h of a)if(s=Object(s)[h],s===void 0)return n;return s};function zn(e,t){const n=Object.assign({},e);for(const a of t)delete n[a];return n}const an=(e,t=!1)=>{const n=`Warning: [vue-request] ${e}`;if(t)return new Error(n);console.error(n)},Hn=(e,t)=>{let n=!1;return(...a)=>{n||(n=!0,e(...a),setTimeout(()=>{n=!1},t))}};var Se;const on=new Set,rn=new Set,sn=new Set,he=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=on;break;case"RECONNECT_LISTENER":n=sn;break;case"VISIBLE_LISTENER":n=rn;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},ke=e=>{e.forEach(t=>{t()})};!Ae&&(Se=window)!==null&&Se!==void 0&&Se.addEventListener&&(window.addEventListener("visibilitychange",()=>{Pe()&&ke(rn)},!1),window.addEventListener("focus",()=>ke(on),!1),window.addEventListener("online",()=>ke(sn),!1));function ln(e,t,n){let a,s,h,g,r,u,p=0,_=!1,l=!1,$=!0;const O=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,ce(n)&&(_=!!n.leading,l="maxWait"in n,h=l?Math.max(+n.maxWait||0,t):h,$="trailing"in n?!!n.trailing:$);function S(c){const f=a,I=s;return a=s=void 0,p=c,g=e.apply(I,f),g}function E(c,f){return O?(window.cancelAnimationFrame(r),window.requestAnimationFrame(c)):setTimeout(c,f)}function v(c){if(O)return window.cancelAnimationFrame(c);clearTimeout(c)}function y(c){return p=c,r=E(o,t),_?S(c):g}function Q(c){const f=c-u,I=c-p,L=t-f;return l?Math.min(L,h-I):L}function Y(c){const f=c-u,I=c-p;return u===void 0||f>=t||f<0||l&&I>=h}function o(){const c=Date.now();if(Y(c))return b(c);r=E(o,Q(c))}function b(c){return r=void 0,$&&a?S(c):(a=s=void 0,g)}function k(){r!==void 0&&v(r),p=0,a=u=s=r=void 0}function z(){return r===void 0?g:b(Date.now())}function j(){return r!==void 0}function N(...c){const f=Date.now(),I=Y(f);if(a=c,s=this,u=f,I){if(r===void 0)return y(u);if(l)return r=E(o,t),S(u)}return r===void 0&&(r=E(o,t)),g}return N.cancel=k,N.flush=z,N.pending=j,N}function un(e,t){for(const n in t)if(t[n]!==void 0){if(!ce(t[n])||!ce(e[n])||!(n in e)){e[n]=t[n];continue}(tn(t[n])||Un(t[n]))&&un(e[n],t[n])}}function ze(e,...t){const n=Object.assign({},e);if(!t.length)return n;for(const a of t)un(n,a);return n}function Vn(e,t,n){let a=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return ce(n)&&(a="leading"in n?!!n.leading:a,s="trailing"in n?!!n.trailing:s),ln(e,t,{leading:a,trailing:s,maxWait:t})}const Gn=(e,t)=>n=>{Object.keys(n).forEach(a=>{e[a].value=n[a]}),t.forEach(a=>a(e))},ye=(e,t,n)=>{var a,s,h;const{initialAutoRunFlag:g,initialData:r,loadingDelay:u,pollingInterval:p,debounceInterval:_,debounceOptions:l,throttleInterval:$,throttleOptions:O,pollingWhenHidden:S,pollingWhenOffline:E,errorRetryCount:v,errorRetryInterval:y,stopPollingWhenHiddenOrOffline:Q,refreshOnWindowFocus:Y,refocusTimespan:o,updateCache:b,formatResult:k,onSuccess:z,onError:j,onBefore:N,onAfter:c}=t,f=w(0),I=w((a=n==null?void 0:n.loading)!==null&&a!==void 0?a:!1),L=w((s=n==null?void 0:n.data)!==null&&s!==void 0?s:r),K=w(n==null?void 0:n.error),q=w((h=n==null?void 0:n.params)!==null&&h!==void 0?h:[]),m=Gn({loading:I,data:L,error:K,params:q},[d=>b(d)]),T=()=>{f.value=0},U=w(0),G=w(),x=w(),te=w(),de=()=>{G.value&&G.value(),te.value&&te.value(),x.value&&x.value()},ie=()=>{let d;return u&&(d=setTimeout(m,u,{loading:!0})),()=>d&&clearTimeout(d)},fe=d=>{if(K.value&&v!==0)return;let D;if(!be(p)&&p>=0)if((S||Pe())&&(E||Ue()))D=setTimeout(d,p);else{Q.value=!0;return}return()=>D&&clearTimeout(D)},me=A(()=>{if(y)return y;const d=1e3,D=1,B=9,Z=Math.floor(Math.random()*qe(2,Math.min(f.value,B))+D);return d*Z}),i=d=>{let D;const B=v===-1,Z=f.value<v;return K.value&&(B||Z)&&(B||(f.value+=1),D=setTimeout(d,me.value)),()=>D&&clearTimeout(D)},R=(...d)=>{m({loading:!u,params:d}),te.value=ie(),U.value+=1;const D=U.value;return N==null||N(d),e(...d).then(B=>{if(D===U.value){const Z=k?k(B):B;return m({data:Z,loading:!1,error:void 0}),z&&z(Z,d),T(),Z}return ue}).catch(B=>(D===U.value&&(m({data:void 0,loading:!1,error:B}),j&&j(B,d),console.error(B)),ue)).finally(()=>{D===U.value&&(te.value(),x.value=i(()=>R(...d)),G.value=fe(()=>R(...d)),c==null||c(d))})},C=!be(_)&&ln(R,_,l),W=!be($)&&Vn(R,$,O),H=(...d)=>(de(),!g.value&&C?(C(...d),ue):W?(W(...d),ue):(T(),R(...d))),J=()=>{U.value+=1,m({loading:!1}),C&&C.cancel(),W&&W.cancel(),de()},X=()=>H(...q.value),dn=d=>{const D=Ee(d)?d(L.value):d;m({data:D})},Me=[],ve=d=>{d&&Me.push(d)},Ne=()=>{Q.value&&(S||Pe())&&(E||Ue())&&(X(),Q.value=!1)};S||ve(he("VISIBLE_LISTENER",Ne)),E||ve(he("RECONNECT_LISTENER",Ne));const je=Hn(X,o);return Y&&(ve(he("VISIBLE_LISTENER",je)),ve(he("FOCUS_LISTENER",je))),{loading:I,data:L,error:K,params:q,run:H,cancel:J,refresh:X,mutate:dn,unmount:()=>{Me.forEach(d=>d())}}},we=new Map,Ie=e=>{if(be(e))return;const t=we.get(e);if(!!t)return{data:t.data,cacheTime:t.cacheTime}},xn=(e,t,n)=>{const a=we.get(e);a!=null&&a.timer&&clearTimeout(a.timer);const s=setTimeout(()=>we.delete(e),n);we.set(e,{data:t,timer:s,cacheTime:new Date().getTime()})},ae="__QUERY_DEFAULT_KEY__";function Jn(e,t){const n=xe(De,{}),me=P(P(P({},en()),n),t),{cacheKey:a,defaultParams:s=[],manual:h=!1,ready:g=w(!0),refreshDeps:r=[],loadingDelay:u=0,pollingWhenHidden:p=!1,pollingWhenOffline:_=!1,refreshOnWindowFocus:l=!1,refocusTimespan:$=5e3,cacheTime:O=6e5,staleTime:S=0,errorRetryCount:E=0,errorRetryInterval:v=0,queryKey:y}=me,Q=se(me,["cacheKey","defaultParams","manual","ready","refreshDeps","loadingDelay","pollingWhenHidden","pollingWhenOffline","refreshOnWindowFocus","refocusTimespan","cacheTime","staleTime","errorRetryCount","errorRetryInterval","queryKey"]),Y=w(!1),o=w(!1),k=P({initialAutoRunFlag:o,loadingDelay:u,pollingWhenHidden:p,pollingWhenOffline:_,stopPollingWhenHiddenOrOffline:Y,cacheKey:a,errorRetryCount:E,errorRetryInterval:v,refreshOnWindowFocus:l,refocusTimespan:$,updateCache:i=>{var R,C;if(!a)return;const W=(R=Ie(a))===null||R===void 0?void 0:R.data,H=W==null?void 0:W.queries,J=Yn(i),X=(C=y==null?void 0:y(...i.params.value))!==null&&C!==void 0?C:ae;xn(a,{queries:_e(P({},H),{[X]:P(P({},H==null?void 0:H[X]),J)}),latestQueriesKey:X},O)}},zn(Q,["pagination","listKey"])),z=w(!1),j=w(),N=w(),c=w(),f=oe({[ae]:oe(ye(e,k))}),I=w(ae),L=A(()=>{var i;return(i=f[I.value])!==null&&i!==void 0?i:{}});if(Ce(L,i=>{z.value=i.loading,j.value=i.data,N.value=i.error,c.value=i.params},{immediate:!0,deep:!0}),a){var K;const i=Ie(a);i!=null&&(K=i.data)!==null&&K!==void 0&&K.queries&&(Object.keys(i.data.queries).forEach(R=>{const C=i.data.queries[R];f[R]=oe(ye(e,k,{loading:C.loading,params:C.params,data:C.data,error:C.error}))}),i.data.latestQueriesKey&&(I.value=i.data.latestQueriesKey))}const q=w(),m=w(!1),T=(...i)=>{var R;if(!g.value&&!m.value)return q.value=i,ue;const C=(R=y==null?void 0:y(...i))!==null&&R!==void 0?R:ae;return f[C]||(f[C]=oe(ye(e,k))),I.value=C,L.value.run(...i)},U=()=>{G(),I.value=ae,f[ae]=oe(ye(e,k))},G=()=>{Object.keys(f).forEach(i=>{f[i].cancel(),f[i].unmount(),delete f[i]})},x=()=>L.value.cancel(),te=()=>L.value.refresh(),de=i=>L.value.mutate(i);if(!h){var ie;o.value=!0;const i=Ie(a),R=(ie=i==null?void 0:i.data.queries)!==null&&ie!==void 0?ie:{},C=i&&(S===-1||i.cacheTime+S>new Date().getTime()),W=Object.keys(R).length>0;C||(W?Object.keys(f).forEach(H=>{var J;(J=f[H])===null||J===void 0||J.refresh()}):T(...s)),o.value=!1}const fe=w();return fe.value=Ce(g,i=>{m.value=!0,i&&q.value&&(T(...q.value),fe.value())},{flush:"sync"}),r.length&&Ce(r,()=>{!h&&L.value.refresh()}),kn(()=>{G()}),{loading:z,data:j,error:N,params:c,cancel:x,refresh:te,mutate:de,run:T,reset:U,queries:f}}const cn=e=>(...t)=>{if(Ee(e))return cn(e(...t))();if(Wn(e))return e;if(tn(e)){const n=e,{url:a}=n,s=se(n,["url"]);return We(a,s)}else{if(qn(e))return We(e);throw an("Unknown service type",!0)}};function Xn(e,t){var n,a;const s=cn(e),h={pagination:{currentKey:"current",pageSizeKey:"pageSize",totalKey:"total",totalPageKey:"totalPage"}},g=xe(De,{}),K=ze(h,{pagination:(n=en().pagination)!==null&&n!==void 0?n:{}},{pagination:(a=g.pagination)!==null&&a!==void 0?a:{}},t!=null?t:{}),{pagination:{currentKey:r,pageSizeKey:u,totalKey:p,totalPageKey:_},queryKey:l}=K,$=se(K,["pagination","queryKey"]);l&&an("usePagination does not support concurrent request");const O=ze({defaultParams:[{[r]:1,[u]:10}]},$),q=Jn(s,O),{data:S,params:E,queries:v,run:y,reset:Q}=q,Y=se(q,["data","params","queries","run","reset"]),o=m=>{const[T,...U]=E.value,x=[P(P({},T),m),...U];y(...x)},b=m=>{o({[r]:m})},k=m=>{o({[u]:m})},z=(m,T)=>{o({[r]:m,[u]:T})},j=w(!1),N=()=>Te(this,null,function*(){const{defaultParams:m,manual:T}=O;Q(),T||(j.value=!0,yield y(...m),j.value=!1)}),c=A(()=>Ye(S.value,p,0)),f=A({get:()=>{var m,T;return(m=(T=E.value[0])===null||T===void 0?void 0:T[r])!==null&&m!==void 0?m:O.defaultParams[0][r]},set:m=>{b(m)}}),I=A({get:()=>{var m,T;return(m=(T=E.value[0])===null||T===void 0?void 0:T[u])!==null&&m!==void 0?m:O.defaultParams[0][u]},set:m=>{k(m)}}),L=A(()=>Ye(S.value,_,Math.ceil(c.value/I.value)));return P({data:S,params:E,current:f,pageSize:I,total:c,totalPage:L,reloading:j,run:y,changeCurrent:b,changePageSize:k,changePagination:z,reload:N},Y)}const Zn="YYYY-MM-DD HH:mm:ss",et="YYYY-MM-DD ";function nt(e=void 0,t=Zn){return Le(e).format(t)}function He(e=void 0,t=et){return Le(e).format(t)}const tt=Fe({props:["bordered","hiddenFilter","url","columns","actions","button","items","model","resKey","scroll"],setup(e){const{hasPermission:t}=Je(),{hasRole:n}=Xe(),{data:a,run:s,loading:h,current:g,pageSize:r,total:u,refresh:p}=Xn(e.url,{pagination:{pageSizeKey:"limit",currentKey:"page"}}),_=A(()=>{var o;return(o=e.bordered)!=null?o:!0}),l=A(()=>{var o,b;return((b=a.value)==null?void 0:b[((o=e==null?void 0:e.resKey)==null?void 0:o.list)||"list"])||[]}),$=A(()=>({total:u.value,current:g.value,pageSize:r.value,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>Rn("span",{},`\u5171 ${u.value} \u6761`)})),O=(o,b,k)=>{s(P({limit:o.pageSize,page:o==null?void 0:o.current,sortField:k.field,sortOrder:k.order},b))},S=A(()=>(Re(e.actions)||[]).map(o=>{const{popConfirm:b}=o;return _e(P(P({type:"link"},o),b||{}),{enable:!!b,permission:t(o.auth)&&n(o.role)})})),E=A(()=>e.model),v=A(()=>e.button),y=A(()=>e.items);return{dataSource:l,loading:h,pagination:$,hasBordered:_,handleTableChange:O,run:s,refresh:p,getActions:S,tableFilterModel:E,tableFilterButton:v,tableFilterItems:y,onSearch:()=>{const o=Re(E.value)||{};o&&Object.keys(o).map(b=>{o[b]&&Le.isMoment(o[b])&&(o[b]=He(o[b]))}),s(P({page:g.value,limit:r.value},o))},formatDate:(o,b="date")=>{const k=b==="date"?He:nt;return o.length===10?k(Number(o)*1e3):k(o)}}}}),at={class:"table-component"},ot=["type"],rt={key:1},it=["onClick","type"];function st(e,t,n,a,s,h){const g=Kn,r=Fn,u=Ln,p=Dn;return F(),ne("div",at,[ee(g,{button:e.tableFilterButton,items:e.tableFilterItems,model:e.tableFilterModel,hiddenFilter:e.hiddenFilter,pagination:null,onOnSearch:e.onSearch},null,8,["button","items","model","hiddenFilter","onOnSearch"]),ee(p,{class:Pn(["ant-table-striped",{border:e.hasBordered}]),rowClassName:(_,l)=>l%2===1?"table-striped":null,dataSource:e.dataSource,columns:e.columns,rowKey:_=>_.id,pagination:e.pagination,loading:e.loading,onChange:e.handleTableChange,scroll:e.scroll},{toDate:M(({text:_})=>[Oe("span",null,re(_?e.formatDate(_):"-"),1)]),toDateTime:M(({text:_})=>[Oe("span",null,re(_?e.formatDate(_,"time"):"-"),1)]),action:M(({record:_})=>[(F(!0),ne($e,null,Ge(e.getActions,(l,$)=>(F(),ne($e,{key:`${$}-${l.label}`},[l.enable?(F(),V(r,{key:0,title:l==null?void 0:l.title,onConfirm:O=>l==null?void 0:l.onConfirm(_),onCancel:O=>l==null?void 0:l.onCancel(_)},{default:M(()=>[Oe("a",{onClick:t[0]||(t[0]=$n(()=>{},["prevent"])),type:l.type},re(l.label),9,ot)]),_:2},1032,["title","onConfirm","onCancel"])):l.permission?(F(),ne("a",{key:2,onClick:O=>l==null?void 0:l.onClick(_),type:l.type},re(l.label),9,it)):(F(),ne("span",rt,"\u2014\u2014")),$<e.getActions.length-1?(F(),V(u,{key:3,type:"vertical"})):le("",!0)],64))),128))]),_:1},8,["class","rowClassName","dataSource","columns","rowKey","pagination","loading","onChange","scroll"])])}var ft=Ze(tt,[["render",st],["__scopeId","data-v-f3ed522e"]]);export{ft as _};
