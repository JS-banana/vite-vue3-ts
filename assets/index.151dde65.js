var fn=Object.defineProperty,mn=Object.defineProperties;var vn=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var qe=Math.pow,Ke=(e,t,n)=>t in e?fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,P=(e,t)=>{for(var n in t||(t={}))Be.call(t,n)&&Ke(e,n,t[n]);if(pe)for(var n of pe(t))Qe.call(t,n)&&Ke(e,n,t[n]);return e},_e=(e,t)=>mn(e,vn(t));var le=(e,t)=>{var n={};for(var o in e)Be.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&pe)for(var o of pe(e))t.indexOf(o)<0&&Qe.call(e,o)&&(n[o]=e[o]);return n};var we=(e,t,n)=>new Promise((o,l)=>{var h=u=>{try{r(n.next(u))}catch(p){l(p)}},g=u=>{try{r(n.throw(u))}catch(p){l(p)}},r=u=>u.done?o(u.value):Promise.resolve(u.value).then(h,g);r((n=n.apply(e,t)).next())});import{e as Fe,d as ae,c as A,r as E,W as pn,N as Re,m as F,j as V,k as j,q as ee,X as ne,D as re,ac as ie,a8 as ge,a7 as Ve,Z as Ge,Y as $e,ak as _n,am as gn,ao as hn,ap as yn,al as bn,aq as En,_ as Tn,an as wn,ar as Cn,F as On,p as Sn,i as Je,w as Ce,b as kn,u as In,f as Le,h as Rn,B as Oe,as as $n,H as Pn,at as Fn,ae as Ln,au as Dn}from"./antdv.50a355b0.js";import{b as Xe,c as Ze,_ as xe}from"./index.c27314ca.js";const An=Fe({props:["hiddenFilter","button","items","model"],emits:["onSearch"],setup(e,{emit:t}){const{hasPermission:n}=Xe(),{hasRole:o}=Ze(),l=ae(e.model||{}),h=A(()=>(e.items||[]).map(p=>P({type:"input"},p))),g=()=>{t("onSearch")},r=E(e.hiddenFilter);pn(()=>{!e.button&&!e.items&&(r.value=!0)});const u=A(()=>{const p=Re(e.button)||{};return _e(P({},p),{permission:n(p.auth)&&o(p.role)})});return{formModel:l,getItems:h,hasHidden:r,getButton:u,handleSubmit:g}}}),jn={key:0,class:"text"},Mn=Ve("\u67E5\u8BE2");function Nn(e,t,n,o,l,h){const g=_n,r=gn,u=hn,p=yn,_=bn,i=En,$=Tn,O=wn,S=Cn,T=On;return e.hasHidden?ie("",!0):(F(),V(T,{key:0,"body-style":{padding:"0 0 24px 0"},bordered:!1},{default:j(()=>[ee(S,{class:"form-container",layout:"horizontal",model:e.formModel},{default:j(()=>[ee(O,{type:"flex"},{default:j(()=>[e.button?(F(),V(r,{key:0,flex:"100px"},{default:j(()=>{var v;return[e.button.type==="text"?(F(),ne("span",jn,re(e.button.label),1)):ie("",!0),e.getButton.permission?(F(),V(g,ge({key:1},e.button,{onClick:(v=e.button)==null?void 0:v.onClick}),{default:j(()=>[Ve(re(e.button.label),1)]),_:1},16,["onClick"])):ie("",!0)]}),_:1})):ie("",!0),ee(r,{flex:"auto",class:"rowE"},{default:j(()=>[ee($,null,{default:j(()=>[(F(!0),ne($e,null,Ge(e.getItems,v=>(F(),V(i,{key:v.name,name:v.name},{default:j(()=>[v.type==="select"?(F(),V(u,ge({key:0,key:`select-${v.name}`},v,{value:e.formModel[v.name],"onUpdate:value":y=>e.formModel[v.name]=y,class:"default-select-w"}),null,16,["value","onUpdate:value"])):v.type==="date"?(F(),V(p,ge({key:1,key:`date-${v.name}`},v,{value:e.formModel[v.name],"onUpdate:value":y=>e.formModel[v.name]=y,class:"default-select-w"}),null,16,["value","onUpdate:value"])):(F(),V(_,ge({key:2},v,{key:`input-${v.name}`,value:e.formModel[v.name],"onUpdate:value":y=>e.formModel[v.name]=y,onSearch:e.handleSubmit,class:"default-search-w"}),{enterButton:j(()=>[ee(g,{type:"primary"},{default:j(()=>[Mn]),_:1})]),_:2},1040,["value","onUpdate:value","onSearch"]))]),_:2},1032,["name"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}))}var Kn=xe(An,[["render",Nn],["__scopeId","data-v-49edeabf"]]);const Bn={},De=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),en=()=>Bn;Fe({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:t}){const{config:n}=e;return Sn(De,n),()=>{var o;return(o=t.default)===null||o===void 0?void 0:o.call(t)}}});const Qn=Object.prototype.toString,nn=e=>Qn.call(e),qn=e=>nn(e)==="[object String]",tn=e=>nn(e)==="[object Object]",Un=e=>Array.isArray(e),ce=e=>e!==null&&typeof e=="object",Wn=e=>ce(e)&&Te(e.then)&&Te(e.catch),Te=e=>e instanceof Function,be=e=>e==null,Ae=typeof window=="undefined",Pe=()=>{var e,t;return!Ae&&((e=window)===null||e===void 0||(t=e.document)===null||t===void 0?void 0:t.visibilityState)==="visible"},Ue=()=>{var e,t,n;return(e=!Ae&&((t=window)===null||t===void 0||(n=t.navigator)===null||n===void 0?void 0:n.onLine))!==null&&e!==void 0?e:!0},Yn=e=>{const t={};return Object.keys(e).forEach(n=>{t[n]=In(e[n])}),t},ue=Promise.resolve(null),We=(...e)=>we(void 0,null,function*(){const t=yield fetch(...e);if(t.ok)return t.json();throw new Error(t.statusText)}),Ye=(e,t,n=void 0)=>{const o=t.replace(/\[(\d+)\]/g,".$1").split(".");let l=e;for(const h of o)if(l=Object(l)[h],l===void 0)return n;return l};function zn(e,t){const n=Object.assign({},e);for(const o of t)delete n[o];return n}const on=(e,t=!1)=>{const n=`Warning: [vue-request] ${e}`;if(t)return new Error(n);console.error(n)},Hn=(e,t)=>{let n=!1;return(...o)=>{n||(n=!0,e(...o),setTimeout(()=>{n=!1},t))}};var Se;const an=new Set,rn=new Set,sn=new Set,he=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=an;break;case"RECONNECT_LISTENER":n=sn;break;case"VISIBLE_LISTENER":n=rn;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},ke=e=>{e.forEach(t=>{t()})};!Ae&&(Se=window)!==null&&Se!==void 0&&Se.addEventListener&&(window.addEventListener("visibilitychange",()=>{Pe()&&ke(rn)},!1),window.addEventListener("focus",()=>ke(an),!1),window.addEventListener("online",()=>ke(sn),!1));function ln(e,t,n){let o,l,h,g,r,u,p=0,_=!1,i=!1,$=!0;const O=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,ce(n)&&(_=!!n.leading,i="maxWait"in n,h=i?Math.max(+n.maxWait||0,t):h,$="trailing"in n?!!n.trailing:$);function S(c){const f=o,I=l;return o=l=void 0,p=c,g=e.apply(I,f),g}function T(c,f){return O?(window.cancelAnimationFrame(r),window.requestAnimationFrame(c)):setTimeout(c,f)}function v(c){if(O)return window.cancelAnimationFrame(c);clearTimeout(c)}function y(c){return p=c,r=T(a,t),_?S(c):g}function Q(c){const f=c-u,I=c-p,L=t-f;return i?Math.min(L,h-I):L}function Y(c){const f=c-u,I=c-p;return u===void 0||f>=t||f<0||i&&I>=h}function a(){const c=Date.now();if(Y(c))return b(c);r=T(a,Q(c))}function b(c){return r=void 0,$&&o?S(c):(o=l=void 0,g)}function k(){r!==void 0&&v(r),p=0,o=u=l=r=void 0}function z(){return r===void 0?g:b(Date.now())}function N(){return r!==void 0}function M(...c){const f=Date.now(),I=Y(f);if(o=c,l=this,u=f,I){if(r===void 0)return y(u);if(i)return r=T(a,t),S(u)}return r===void 0&&(r=T(a,t)),g}return M.cancel=k,M.flush=z,M.pending=N,M}function un(e,t){for(const n in t)if(t[n]!==void 0){if(!ce(t[n])||!ce(e[n])||!(n in e)){e[n]=t[n];continue}(tn(t[n])||Un(t[n]))&&un(e[n],t[n])}}function ze(e,...t){const n=Object.assign({},e);if(!t.length)return n;for(const o of t)un(n,o);return n}function Vn(e,t,n){let o=!0,l=!0;if(typeof e!="function")throw new TypeError("Expected a function");return ce(n)&&(o="leading"in n?!!n.leading:o,l="trailing"in n?!!n.trailing:l),ln(e,t,{leading:o,trailing:l,maxWait:t})}const Gn=(e,t)=>n=>{Object.keys(n).forEach(o=>{e[o].value=n[o]}),t.forEach(o=>o(e))},ye=(e,t,n)=>{var o,l,h;const{initialAutoRunFlag:g,initialData:r,loadingDelay:u,pollingInterval:p,debounceInterval:_,debounceOptions:i,throttleInterval:$,throttleOptions:O,pollingWhenHidden:S,pollingWhenOffline:T,errorRetryCount:v,errorRetryInterval:y,stopPollingWhenHiddenOrOffline:Q,refreshOnWindowFocus:Y,refocusTimespan:a,updateCache:b,formatResult:k,onSuccess:z,onError:N,onBefore:M,onAfter:c}=t,f=E(0),I=E((o=n==null?void 0:n.loading)!==null&&o!==void 0?o:!1),L=E((l=n==null?void 0:n.data)!==null&&l!==void 0?l:r),K=E(n==null?void 0:n.error),q=E((h=n==null?void 0:n.params)!==null&&h!==void 0?h:[]),m=Gn({loading:I,data:L,error:K,params:q},[d=>b(d)]),w=()=>{f.value=0},U=E(0),G=E(),J=E(),te=E(),de=()=>{G.value&&G.value(),te.value&&te.value(),J.value&&J.value()},se=()=>{let d;return u&&(d=setTimeout(m,u,{loading:!0})),()=>d&&clearTimeout(d)},fe=d=>{if(K.value&&v!==0)return;let D;if(!be(p)&&p>=0)if((S||Pe())&&(T||Ue()))D=setTimeout(d,p);else{Q.value=!0;return}return()=>D&&clearTimeout(D)},me=A(()=>{if(y)return y;const d=1e3,D=1,B=9,x=Math.floor(Math.random()*qe(2,Math.min(f.value,B))+D);return d*x}),s=d=>{let D;const B=v===-1,x=f.value<v;return K.value&&(B||x)&&(B||(f.value+=1),D=setTimeout(d,me.value)),()=>D&&clearTimeout(D)},R=(...d)=>{m({loading:!u,params:d}),te.value=se(),U.value+=1;const D=U.value;return M==null||M(d),e(...d).then(B=>{if(D===U.value){const x=k?k(B):B;return m({data:x,loading:!1,error:void 0}),z&&z(x,d),w(),x}return ue}).catch(B=>(D===U.value&&(m({data:void 0,loading:!1,error:B}),N&&N(B,d),console.error(B)),ue)).finally(()=>{D===U.value&&(te.value(),J.value=s(()=>R(...d)),G.value=fe(()=>R(...d)),c==null||c(d))})},C=!be(_)&&ln(R,_,i),W=!be($)&&Vn(R,$,O),H=(...d)=>(de(),!g.value&&C?(C(...d),ue):W?(W(...d),ue):(w(),R(...d))),X=()=>{U.value+=1,m({loading:!1}),C&&C.cancel(),W&&W.cancel(),de()},Z=()=>H(...q.value),dn=d=>{const D=Te(d)?d(L.value):d;m({data:D})},je=[],ve=d=>{d&&je.push(d)},Me=()=>{Q.value&&(S||Pe())&&(T||Ue())&&(Z(),Q.value=!1)};S||ve(he("VISIBLE_LISTENER",Me)),T||ve(he("RECONNECT_LISTENER",Me));const Ne=Hn(Z,a);return Y&&(ve(he("VISIBLE_LISTENER",Ne)),ve(he("FOCUS_LISTENER",Ne))),{loading:I,data:L,error:K,params:q,run:H,cancel:X,refresh:Z,mutate:dn,unmount:()=>{je.forEach(d=>d())}}},Ee=new Map,Ie=e=>{if(be(e))return;const t=Ee.get(e);if(!!t)return{data:t.data,cacheTime:t.cacheTime}},Jn=(e,t,n)=>{const o=Ee.get(e);o!=null&&o.timer&&clearTimeout(o.timer);const l=setTimeout(()=>Ee.delete(e),n);Ee.set(e,{data:t,timer:l,cacheTime:new Date().getTime()})},oe="__QUERY_DEFAULT_KEY__";function Xn(e,t){const n=Je(De,{}),me=P(P(P({},en()),n),t),{cacheKey:o,defaultParams:l=[],manual:h=!1,ready:g=E(!0),refreshDeps:r=[],loadingDelay:u=0,pollingWhenHidden:p=!1,pollingWhenOffline:_=!1,refreshOnWindowFocus:i=!1,refocusTimespan:$=5e3,cacheTime:O=6e5,staleTime:S=0,errorRetryCount:T=0,errorRetryInterval:v=0,queryKey:y}=me,Q=le(me,["cacheKey","defaultParams","manual","ready","refreshDeps","loadingDelay","pollingWhenHidden","pollingWhenOffline","refreshOnWindowFocus","refocusTimespan","cacheTime","staleTime","errorRetryCount","errorRetryInterval","queryKey"]),Y=E(!1),a=E(!1),k=P({initialAutoRunFlag:a,loadingDelay:u,pollingWhenHidden:p,pollingWhenOffline:_,stopPollingWhenHiddenOrOffline:Y,cacheKey:o,errorRetryCount:T,errorRetryInterval:v,refreshOnWindowFocus:i,refocusTimespan:$,updateCache:s=>{var R,C;if(!o)return;const W=(R=Ie(o))===null||R===void 0?void 0:R.data,H=W==null?void 0:W.queries,X=Yn(s),Z=(C=y==null?void 0:y(...s.params.value))!==null&&C!==void 0?C:oe;Jn(o,{queries:_e(P({},H),{[Z]:P(P({},H==null?void 0:H[Z]),X)}),latestQueriesKey:Z},O)}},zn(Q,["pagination","listKey"])),z=E(!1),N=E(),M=E(),c=E(),f=ae({[oe]:ae(ye(e,k))}),I=E(oe),L=A(()=>{var s;return(s=f[I.value])!==null&&s!==void 0?s:{}});if(Ce(L,s=>{z.value=s.loading,N.value=s.data,M.value=s.error,c.value=s.params},{immediate:!0,deep:!0}),o){var K;const s=Ie(o);s!=null&&(K=s.data)!==null&&K!==void 0&&K.queries&&(Object.keys(s.data.queries).forEach(R=>{const C=s.data.queries[R];f[R]=ae(ye(e,k,{loading:C.loading,params:C.params,data:C.data,error:C.error}))}),s.data.latestQueriesKey&&(I.value=s.data.latestQueriesKey))}const q=E(),m=E(!1),w=(...s)=>{var R;if(!g.value&&!m.value)return q.value=s,ue;const C=(R=y==null?void 0:y(...s))!==null&&R!==void 0?R:oe;return f[C]||(f[C]=ae(ye(e,k))),I.value=C,L.value.run(...s)},U=()=>{G(),I.value=oe,f[oe]=ae(ye(e,k))},G=()=>{Object.keys(f).forEach(s=>{f[s].cancel(),f[s].unmount(),delete f[s]})},J=()=>L.value.cancel(),te=()=>L.value.refresh(),de=s=>L.value.mutate(s);if(!h){var se;a.value=!0;const s=Ie(o),R=(se=s==null?void 0:s.data.queries)!==null&&se!==void 0?se:{},C=s&&(S===-1||s.cacheTime+S>new Date().getTime()),W=Object.keys(R).length>0;C||(W?Object.keys(f).forEach(H=>{var X;(X=f[H])===null||X===void 0||X.refresh()}):w(...l)),a.value=!1}const fe=E();return fe.value=Ce(g,s=>{m.value=!0,s&&q.value&&(w(...q.value),fe.value())},{flush:"sync"}),r.length&&Ce(r,()=>{!h&&L.value.refresh()}),kn(()=>{G()}),{loading:z,data:N,error:M,params:c,cancel:J,refresh:te,mutate:de,run:w,reset:U,queries:f}}const cn=e=>(...t)=>{if(Te(e))return cn(e(...t))();if(Wn(e))return e;if(tn(e)){const n=e,{url:o}=n,l=le(n,["url"]);return We(o,l)}else{if(qn(e))return We(e);throw on("Unknown service type",!0)}};function Zn(e,t){var n,o;const l=cn(e),h={pagination:{currentKey:"current",pageSizeKey:"pageSize",totalKey:"total",totalPageKey:"totalPage"}},g=Je(De,{}),K=ze(h,{pagination:(n=en().pagination)!==null&&n!==void 0?n:{}},{pagination:(o=g.pagination)!==null&&o!==void 0?o:{}},t!=null?t:{}),{pagination:{currentKey:r,pageSizeKey:u,totalKey:p,totalPageKey:_},queryKey:i}=K,$=le(K,["pagination","queryKey"]);i&&on("usePagination does not support concurrent request");const O=ze({defaultParams:[{[r]:1,[u]:10}]},$),q=Xn(l,O),{data:S,params:T,queries:v,run:y,reset:Q}=q,Y=le(q,["data","params","queries","run","reset"]),a=m=>{const[w,...U]=T.value,J=[P(P({},w),m),...U];y(...J)},b=m=>{a({[r]:m})},k=m=>{a({[u]:m})},z=(m,w)=>{a({[r]:m,[u]:w})},N=E(!1),M=()=>we(this,null,function*(){const{defaultParams:m,manual:w}=O;Q(),w||(N.value=!0,yield y(...m),N.value=!1)}),c=A(()=>Ye(S.value,p,0)),f=A({get:()=>{var m,w;return(m=(w=T.value[0])===null||w===void 0?void 0:w[r])!==null&&m!==void 0?m:O.defaultParams[0][r]},set:m=>{b(m)}}),I=A({get:()=>{var m,w;return(m=(w=T.value[0])===null||w===void 0?void 0:w[u])!==null&&m!==void 0?m:O.defaultParams[0][u]},set:m=>{k(m)}}),L=A(()=>Ye(S.value,_,Math.ceil(c.value/I.value)));return P({data:S,params:T,current:f,pageSize:I,total:c,totalPage:L,reloading:N,run:y,changeCurrent:b,changePageSize:k,changePagination:z,reload:M},Y)}const xn="YYYY-MM-DD HH:mm:ss",et="YYYY-MM-DD ";function nt(e=void 0,t=xn){return Le(e).format(t)}function He(e=void 0,t=et){return Le(e).format(t)}const tt=Fe({props:["bordered","hiddenFilter","url","columns","actions","button","items","model","resKey","scroll"],setup(e){const{hasPermission:t}=Xe(),{hasRole:n}=Ze(),{data:o,run:l,loading:h,current:g,pageSize:r,total:u,refresh:p}=Zn(e.url,{pagination:{pageSizeKey:"limit",currentKey:"page"}}),_=A(()=>{var a;return(a=e.bordered)!=null?a:!0}),i=A(()=>{var a,b;return((b=o.value)==null?void 0:b[((a=e==null?void 0:e.resKey)==null?void 0:a.list)||"list"])||[]}),$=A(()=>({total:u.value,current:g.value,pageSize:r.value,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>Rn("span",{},`\u5171 ${u.value} \u6761`)})),O=(a,b,k)=>{l(P({limit:a.pageSize,page:a==null?void 0:a.current,sortField:k.field,sortOrder:k.order},b))},S=A(()=>(Re(e.actions)||[]).map(a=>{const{popConfirm:b}=a;return _e(P(P({type:"link"},a),b||{}),{enable:!!b,permission:t(a.auth)&&n(a.role)})})),T=A(()=>e.model),v=A(()=>e.button),y=A(()=>e.items);return{dataSource:i,loading:h,pagination:$,hasBordered:_,handleTableChange:O,run:l,refresh:p,getActions:S,tableFilterModel:T,tableFilterButton:v,tableFilterItems:y,onSearch:()=>{const a=Re(T.value)||{};a&&Object.keys(a).map(b=>{a[b]&&Le.isMoment(a[b])&&(a[b]=He(a[b]))}),l(P({page:g.value,limit:r.value},a))},formatDate:(a,b="date")=>{const k=b==="date"?He:nt;return a.length===10?k(Number(a)*1e3):k(a)}}}}),ot={class:"table-component"},at=["type"],rt={key:1},st=["onClick","type"];function lt(e,t,n,o,l,h){const g=Kn,r=Fn,u=Ln,p=Dn;return F(),ne("div",ot,[ee(g,{button:e.tableFilterButton,items:e.tableFilterItems,model:e.tableFilterModel,hiddenFilter:e.hiddenFilter,pagination:null,onOnSearch:e.onSearch},null,8,["button","items","model","hiddenFilter","onOnSearch"]),ee(p,{class:Pn(["ant-table-striped",{border:e.hasBordered}]),rowClassName:(_,i)=>i%2===1?"table-striped":null,dataSource:e.dataSource,columns:e.columns,rowKey:_=>_.id,pagination:e.pagination,loading:e.loading,onChange:e.handleTableChange,scroll:e.scroll},{toDate:j(({text:_})=>[Oe("span",null,re(_?e.formatDate(_):"-"),1)]),toDateTime:j(({text:_})=>[Oe("span",null,re(_?e.formatDate(_,"time"):"-"),1)]),action:j(({record:_})=>[(F(!0),ne($e,null,Ge(e.getActions,(i,$)=>(F(),ne($e,{key:`${$}-${i.label}`},[i.enable?(F(),V(r,{key:0,title:i==null?void 0:i.title,onConfirm:O=>i==null?void 0:i.onConfirm(_),onCancel:O=>i==null?void 0:i.onCancel(_)},{default:j(()=>[Oe("a",{onClick:t[0]||(t[0]=$n(()=>{},["prevent"])),type:i.type},re(i.label),9,at)]),_:2},1032,["title","onConfirm","onCancel"])):i.permission?(F(),ne("a",{key:2,onClick:O=>i==null?void 0:i.onClick(_),type:i.type},re(i.label),9,st)):(F(),ne("span",rt,"\u2014\u2014")),$<e.getActions.length-1?(F(),V(u,{key:3,type:"vertical"})):ie("",!0)],64))),128))]),_:1},8,["class","rowClassName","dataSource","columns","rowKey","pagination","loading","onChange","scroll"])])}var ft=xe(tt,[["render",lt],["__scopeId","data-v-f3ed522e"]]);export{ft as _};
